# Phase4 実装計画

**作成日**: 2025年11月28日  
**目標完了日**: 未定（Phase3完了後、優先度に応じて計画）  
**実装期間**: 未定

---

## 📊 Phase3までの実装完了状況

Phase3完了後、以下の機能が実装済みとなります：
- ✅ Phase3-1: 従業員情報の最終更新者・更新日時表示機能の完成
- ✅ Phase3-2: 社会保険用語・ルールヘルプ機能
- ✅ Phase3-3: 従業員情報の変更申請・承認（簡易ワークフロー）機能

---

## 🎯 Phase4の実装方針

Phase4では、**実務上重要な機能**を優先的に実装します。これらの機能は、社会保険管理の実務をより効率化し、手続き漏れを防止することを目的とします。

### Phase4の目標
1. **手続き管理の効率化**: 社会保険手続きの履歴管理と期限管理により、届出漏れを防止
2. **扶養管理の強化**: 被扶養者状況確認・年次見直し支援により、扶養管理業務を効率化
3. **納付管理の実現**: 社会保険料納付状況の管理により、納付漏れを防止

---

## 📋 Phase4の実装フェーズ

### Phase4-1: 社会保険手続き履歴・期限管理機能

**優先度**: 🟡 中（実務上重要な機能）  
**推定工数**: 高（5-7日）  
**推定期間**: 1-2週間  
**依存関係**: Phase2-3（被扶養者管理機能）、Phase2-5（標準報酬履歴管理機能）、Phase1-6（賞与管理機能）

**目的**: 従業員および被扶養者ごとに、健康保険・厚生年金に関する主な社会保険手続きの履歴を登録・閲覧し、提出期限を管理することで、届出漏れ・提出遅れを防止する

**実装内容**:
1. **手続き履歴の型定義** ⚠️
   - ⚠️ `SocialInsuranceProcedure`型の定義（手続きID、従業員ID、被扶養者ID、手続き種別、事由発生日、法定提出期限、手続きステータス、実際の提出日、担当者、備考など）
   - ⚠️ Firestoreコレクション構造の設計（`offices/{officeId}/procedures/{procedureId}`）

2. **手続き種別の定義** ⚠️
   - ⚠️ 資格取得届、資格喪失届、算定基礎届、月額変更届、被扶養者異動届、賞与支払届など
   - ⚠️ 各手続き種別ごとの提出期限計算ロジック（事由発生日から自動計算）

3. **手続き登録・閲覧画面** ⚠️
   - ⚠️ 手続き登録フォーム（手続き種別、事由発生日、担当者、備考の入力）
   - ⚠️ 手続き一覧表示（従業員別、手続き種別別、ステータス別のフィルタリング）
   - ⚠️ 手続き詳細表示（提出期限、ステータス、提出日などの確認）

4. **自動生成機能** ⚠️
   - ⚠️ 入社・退職・標準報酬決定・賞与支給・被扶養者の追加／削除時に、対応する手続きレコードの作成候補を自動生成
   - ⚠️ 人事担当者が内容を確認・確定できるUI

5. **期限管理機能** ⚠️
   - ⚠️ 「提出期限が近い手続き」一覧表示
   - ⚠️ 「提出期限を過ぎて未完了の手続き」一覧表示
   - ⚠️ 簡易カレンダー形式での表示（オプション）

**関連ファイル**:
- ⚠️ `src/app/types.ts`（`SocialInsuranceProcedure`型追加）
- ⚠️ `src/app/services/procedures.service.ts`（新規作成）
- ⚠️ `src/app/pages/procedures/procedures.page.ts`（新規作成）
- ⚠️ `src/app/pages/procedures/procedure-form-dialog.component.ts`（新規作成）
- ⚠️ `firestore.rules`（`procedures`コレクションのルール追加）

**技術要件**:
- ⚠️ Firestoreコレクション設計
- ⚠️ 提出期限の自動計算ロジック
- ⚠️ 日付比較・フィルタリング機能

**注意事項**:
- ⚠️ 提出期限の算出は代表的なルールに基づく目安を提供するにとどめ、最終的な提出要否・期限判断は事業所側の責任とする
- ⚠️ 自動生成された手続きレコードは、人事担当者が内容を確認・確定できるようにする

---

### Phase4-2: 被扶養者状況確認・年次見直し支援機能

**優先度**: 🟡 中（実務上必要な機能）  
**推定工数**: 中（3-4日）  
**推定期間**: 1週間  
**依存関係**: Phase2-3（被扶養者管理機能）

**目的**: 被扶養者の年次見直しや「被扶養者状況リスト」への回答作業を支援する

**実装内容**:
1. **扶養状況確認の型定義** ⚠️
   - ⚠️ `DependentReview`型の定義（確認ID、事業所ID、確認実施年月、担当者など）
   - ⚠️ `DependentReviewResult`型の定義（被扶養者ID、確認日、確認結果、確認担当者、備考など）
   - ⚠️ Firestoreコレクション構造の設計（`offices/{officeId}/dependentReviews/{reviewId}`）

2. **扶養状況確認の登録機能** ⚠️
   - ⚠️ 事業所ごとに「扶養状況確認」を実施した年月および担当者を記録
   - ⚠️ 被扶養者ごとに、直近の扶養状況確認結果を保持（確認日、確認結果、確認担当者、備考）

3. **基準年月日時点での抽出機能** ⚠️
   - ⚠️ 特定の基準年月日時点（例：○年○月1日現在）で扶養に入っている被扶養者の一覧を抽出・表示
   - ⚠️ 健康保険組合等から送付される被扶養者状況リストへの記入・回答作業を効率化

4. **確認結果の一覧表示** ⚠️
   - ⚠️ 被扶養者ごとの確認履歴表示
   - ⚠️ 確認結果別のフィルタリング（継続／削除予定／要確認）

**関連ファイル**:
- ⚠️ `src/app/types.ts`（`DependentReview`型、`DependentReviewResult`型追加）
- ⚠️ `src/app/services/dependent-reviews.service.ts`（新規作成）
- ⚠️ `src/app/pages/dependent-reviews/dependent-reviews.page.ts`（新規作成）
- ⚠️ `firestore.rules`（`dependentReviews`コレクションのルール追加）

**技術要件**:
- ⚠️ Firestoreコレクション設計
- ⚠️ 基準年月日時点での被扶養者抽出ロジック
- ⚠️ 日付比較・フィルタリング機能

**注意事項**:
- ⚠️ 被扶養者資格の最終的な認定（継続・喪失）はあくまで事業所および健康保険組合等の判断とし、本システムは確認結果の記録・参照を支援する役割にとどめる

---

### Phase4-3: 社会保険料納付状況管理機能

**優先度**: 🟡 中（実務上必要な機能）  
**推定工数**: 中（4-5日）  
**推定期間**: 1-2週間  
**依存関係**: Phase1-4（月次保険料一覧機能）、Phase1-6（賞与管理機能）

**目的**: 事業所ごと・対象年月ごとに、健康保険・介護保険・厚生年金それぞれの社会保険料について、納付予定額・実際の納付額・納付日・納付ステータスを記録し、納付漏れや金額確認漏れを防止する

**実装内容**:
1. **納付状況の型定義** ⚠️
   - ⚠️ `PaymentStatus`型の定義（納付ID、事業所ID、対象年月、保険種別、納付予定額、実際の納付額、納付日、納付方法、納付ステータスなど）
   - ⚠️ Firestoreコレクション構造の設計（`offices/{officeId}/payments/{paymentId}`）

2. **納付予定額の自動設定** ⚠️
   - ⚠️ 月次保険料一覧・会社負担集計機能および賞与管理・賞与保険料計算機能で算出された会社負担額の合計値を初期値として自動設定
   - ⚠️ 人事・総務担当者が必要に応じて修正可能

3. **納付状況の登録・編集機能** ⚠️
   - ⚠️ 納付完了後に、納付日および最終的な納付額を登録
   - ⚠️ 納付ステータスの更新（未納／納付済／一部納付）

4. **ダッシュボードへの表示** ⚠️
   - ⚠️ 「今月納付予定の社会保険料」の表示
   - ⚠️ 「納付済み月／未納月の一覧」の表示

**関連ファイル**:
- ⚠️ `src/app/types.ts`（`PaymentStatus`型追加）
- ⚠️ `src/app/services/payments.service.ts`（新規作成）
- ⚠️ `src/app/pages/payments/payments.page.ts`（新規作成）
- ⚠️ `src/app/pages/payments/payment-form-dialog.component.ts`（新規作成）
- ⚠️ `src/app/pages/dashboard/dashboard.page.ts`（納付状況表示追加）
- ⚠️ `firestore.rules`（`payments`コレクションのルール追加）

**技術要件**:
- ⚠️ Firestoreコレクション設計
- ⚠️ 月次保険料・賞与保険料の集計機能との連携
- ⚠️ ダッシュボードへの集計表示

**注意事項**:
- ⚠️ 実際の金融機関への振込処理や会計仕訳の起票は対象外とし、本システムは社会保険料納付状況の記録・確認を支援する役割に限定する

---

## 📅 Phase4の推奨実装順序

### 第1段階（手続き管理）
1. **Phase4-1: 社会保険手続き履歴・期限管理機能**
   - 実務上最も重要な機能のため、最優先で実装
   - 推定期間: 1-2週間

### 第2段階（扶養管理の強化）
2. **Phase4-2: 被扶養者状況確認・年次見直し支援機能**
   - 被扶養者管理機能の拡張として実装
   - 推定期間: 1週間

### 第3段階（納付管理）
3. **Phase4-3: 社会保険料納付状況管理機能**
   - 納付管理の実現により、納付漏れを防止
   - 推定期間: 1-2週間

---

## 🔍 各フェーズの詳細検討事項

### Phase4-1（手続き履歴・期限管理）
- **提出期限計算**: 代表的なルールに基づく目安を提供（例：資格取得日から5日以内など）
- **自動生成**: イベント発生時に手続きレコードの作成候補を自動生成し、人事担当者が確認・確定
- **期限アラート**: 提出期限が近い手続き、期限超過の手続きを一覧表示

### Phase4-2（被扶養者状況確認）
- **基準年月日抽出**: 特定の年月日時点で扶養に入っている被扶養者を抽出
- **確認結果管理**: 確認日、確認結果、確認担当者、備考を記録
- **履歴管理**: 過去の確認履歴を参照可能

### Phase4-3（納付状況管理）
- **自動設定**: 月次保険料・賞与保険料の会社負担額合計を初期値として自動設定
- **手動修正**: 人事・総務担当者が納付予定額を修正可能
- **ステータス管理**: 未納／納付済／一部納付のステータス管理

---

## 📌 注意事項

- **実装優先度**: Phase4-1が最も実務上重要であるため、優先的に実装することを推奨
- **段階的な実装**: Phase4-1 → Phase4-2 → Phase4-3の順で実装し、各フェーズ完了後にテストを実施
- **既存機能との連携**: 月次保険料一覧、賞与管理、被扶養者管理機能との連携を考慮
- **実務ルールの簡略化**: 提出期限の算出などは代表的なルールに基づく目安を提供するにとどめ、最終判断は事業所側の責任とする

---

## 🚀 Phase4以降の展望

Phase4完了後、以下の機能をPhase5以降として検討可能：

1. **e-Gov電子申請連携機能（(22)）**
   - 電子申請用データの自動生成
   - 電子申請用ファイルの出力

2. **公的帳票（届出書）自動作成・PDF出力機能（(23)）**
   - 帳票テンプレートの定義
   - PDF出力機能

3. **従業員セルフ入力・手続き申請フロー機能（(24)）**
   - セルフ入力フォーム
   - 手続き申請の一時保存機能

4. **その他の将来拡張機能（(25)～(34)）**
   - 添付書類管理機能
   - クラウドマスタ機能
   - マイナンバー管理機能
   - 多言語対応機能
   - 異常値チェック機能
   - 手続きタスク期限別ビュー機能
   - 外部給与システム連携機能
   - 口座情報・給与情報管理機能
   - 入社手続きフロー機能
   - 年末調整用集計機能

以上でPhase4の実装計画は完了です。各フェーズの詳細な実装指示書は、実装開始前に作成することを推奨します。

