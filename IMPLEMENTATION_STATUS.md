# InsurePath 実装状況レポート

**作成日**: 2025年1月  
**最終更新**: 2025年11月（Phase1-11完了後）

## 概要

本ドキュメントは、CATALOG.mdに記載された21の機能要件に対する現時点での実装状況をまとめたものです。

---

## ✅ 実装済み機能

### (12) 賞与管理・賞与保険料計算機能（実装済み）

**実装状況**: 賞与支給履歴の登録・閲覧・計算機能は実装済み

- ✅ ページコンポーネントとルーティング
- ✅ 型定義（BonusPremium）
- ✅ 賞与支給履歴の登録・閲覧・編集・削除
- ✅ 標準賞与額の計算（1,000円未満切り捨て）
- ✅ 賞与保険料の計算ロジック（健康保険・厚生年金）
- ✅ 上限チェック（健康保険573万円/年度累計、厚生年金150万円/回）
- ✅ 年度（4月1日基準）の自動判定
- ✅ 健康保険の年度内累計標準賞与額の管理
- ✅ マスタからの保険料率自動取得
- ✅ 計算結果プレビュー表示
- ✅ 本人負担額・会社負担額の集計表示

**関連ファイル**:
- `src/app/pages/premiums/bonus/bonus-premiums.page.ts`（実装済み）
- `src/app/pages/premiums/bonus/bonus-form-dialog.component.ts`（実装済み）
- `src/app/services/bonus-premiums.service.ts`（実装済み）
- `src/app/utils/bonus-calculator.ts`（実装済み）

### (2) ユーザー・ロール管理機能（部分実装）

**実装状況**: 基本認証とユーザープロファイル管理は実装済み

- ✅ Firebase Authenticationによるログイン認証
- ✅ ユーザープロファイル（UserProfile）の型定義と保存
- ✅ 所属事業所ID（officeId）とロール（admin/hr/employee）の保持
- ✅ 従業員ID（employeeId）の自動紐づけ機能（Phase1-8で実装）
- ⚠️ ロール別アクセス制御の実装は未完了（ガードは存在するが、画面レベルでの制御は未実装）

**関連ファイル**:
- `src/app/services/auth.service.ts`
- `src/app/services/current-user.service.ts`
- `src/app/guards/auth.guard.ts`
- `src/app/guards/office.guard.ts`

### (1) 事業所（会社）管理機能（基本実装）

**実装状況**: CRUD操作は実装済み

- ✅ 事業所の基本情報（事業所名、所在地、健康保険種別）の登録・編集
- ✅ 協会けんぽ／組合健保の選択
- ✅ 都道府県支部の選択（協会けんぽ）
- ✅ 健康保険組合名の登録（組合健保）
- ⚠️ 保険料率の初期値設定は未実装

**関連ファイル**:
- `src/app/services/offices.service.ts`
- `src/app/pages/offices/offices.page.ts`
- `src/app/pages/office-setup/office-setup.page.ts`

### (3) 従業員台帳・在籍・資格情報・就労条件管理機能（実装済み）

**実装状況**: 基本情報のCRUDと資格情報・就業状態管理は実装済み

- ✅ 従業員の基本情報（氏名、フリガナ、生年月日、住所、電話番号、メールアドレス、入社日、退職日、所属部署）
- ✅ 雇用区分（正社員・契約社員・パート・アルバイト等）
- ✅ 報酬月額（月給）
- ✅ 所定労働時間・所定労働日数
- ✅ 雇用契約期間の見込み
- ✅ 学生フラグ
- ✅ 健康保険の被保険者記号・番号
- ✅ 厚生年金の被保険者番号
- ✅ 社会保険加入フラグ（isInsured）
- ✅ 健康保険・厚生年金の等級・標準報酬月額の保持
- ✅ 最終更新者・更新日時の記録
- ✅ 資格取得日・資格喪失日の管理（健康保険・厚生年金）
- ✅ 資格取得区分・資格喪失理由区分（健康保険・厚生年金）
- ✅ 就業状態（通常勤務／産前産後休業／育児休業／傷病休職等）の管理
- ✅ 就業状態の期間・保険料扱いの管理
- ✅ 介護保険対象判定の自動化（premium-calculator.tsで実装済み）
- ✅ 入社日・退職日・資格日からの「計上対象月」自動判定ロジック（premium-calculator.tsで実装済み）

**関連ファイル**:
- `src/app/services/employees.service.ts`
- `src/app/pages/employees/employees.page.ts`
- `src/app/pages/employees/employee-form-dialog.component.ts`
- `src/app/pages/employees/employee-detail-dialog.component.ts`
- `src/app/utils/label-utils.ts`（新規追加）

---

## 🚧 部分実装・プレースホルダー状態

### (8) 月次保険料一覧・会社負担集計機能（実装済み）

**実装状況**: 計算・保存・一覧表示・マスタ連携・機能拡張は実装済み（Phase1-9完了）

- ✅ ページコンポーネントとルーティング
- ✅ 保険料計算ロジック（premium-calculator.ts経由）
- ✅ 一括計算・保存機能
- ✅ 一覧表示（シート形式）
- ✅ 会社負担額総計の集計
- ✅ 本人負担額総計の集計
- ✅ マスタからの料率自動取得
- ✅ 適用料率の表示
- ✅ 過去月分の一覧表示（年月選択UI、直近12ヶ月対応）
- ✅ 従業員名での絞り込み機能
- ✅ 月単位の合計行表示（本人負担・会社負担）
- ✅ 初期表示で当月分を自動ロード

**関連ファイル**:
- `src/app/pages/premiums/monthly/monthly-premiums.page.ts`（実装済み）
- `src/app/services/monthly-premiums.service.ts`（実装済み）
- `src/app/utils/premium-calculator.ts`（実装済み）

### (10) 保険料シミュレーション機能（実装済み）

**実装状況**: Phase1-11完了により、保険料シミュレーション機能が完全実装済み

- ✅ ページコンポーネントとルーティング
- ✅ シミュレーション計算ロジック（`premium-calculator.ts`を再利用）
- ✅ 入力フォーム（対象年月、報酬月額、健康保険等級、厚生年金等級、介護保険対象フラグ）
- ✅ 結果表示（等級・標準報酬月額、各保険の本人負担額・会社負担額・合計、トータル）
- ✅ マスタからの保険料率自動取得
- ✅ エラーハンドリング（マスタ未設定、料率未設定など）
- ✅ 既存の月次保険料計算ロジックとの整合性確保

**関連ファイル**:
- `src/app/pages/simulator/simulator.page.ts`（実装済み）
- `src/app/utils/premium-calculator.ts`（再利用）

### (11) 負担構成ダッシュボード機能（基本実装済み）

**実装状況**: Phase1-10完了により、KPIカードの基本機能が実装済み

- ✅ ページコンポーネントとルーティング
- ✅ 従業員数カード（社会保険加入者数または全従業員数）
- ✅ 月次保険料カード（今月の会社負担額合計）
- ✅ トレンドカード（前月比の変化、増減率%）
- ✅ データ取得と集計ロジック
- ✅ エラーハンドリングとデータなし時の表示
- ⚠️ グラフ表示（将来の拡張）
- ⚠️ 賞与保険料を含めた集計（将来の拡張）
- ⚠️ 従業員別ランキング（将来の拡張）

**関連ファイル**:
- `src/app/pages/dashboard/dashboard.page.ts`（実装済み）

### (9) 従業員別保険料明細（マイページ）機能（実装済み）

**実装状況**: Phase1-7で完全実装済み

- ✅ ページコンポーネントとルーティング
- ✅ 基本情報の表示（氏名、所属部署、入社日、等級・標準報酬月額、社会保険加入状況）
- ✅ 月次保険料明細の表示（直近12ヶ月分）
- ✅ 賞与保険料明細の表示
- ✅ 本人・会社負担額の表示
- ✅ 空データ時の適切なメッセージ表示
- ✅ 従業員IDによる自動フィルタリング（セキュリティ確保）
- ⚠️ 推移グラフ（未実装、将来の拡張）

**関連ファイル**:
- `src/app/pages/me/my-page.ts`（実装済み）
- `src/app/services/monthly-premiums.service.ts`（`listByOfficeAndEmployee`メソッド追加）

### (12) 賞与管理・賞与保険料計算機能（実装済み）

**実装状況**: 賞与支給履歴の登録・閲覧・計算機能は実装済み

- ✅ ページコンポーネントとルーティング
- ✅ 型定義（BonusPremium）
- ✅ 賞与支給履歴の登録・閲覧・編集・削除
- ✅ 標準賞与額の計算（1,000円未満切り捨て）
- ✅ 賞与保険料の計算ロジック（健康保険・厚生年金）
- ✅ 上限チェック（健康保険573万円/年度累計、厚生年金150万円/回）
- ✅ 年度（4月1日基準）の自動判定
- ✅ 健康保険の年度内累計標準賞与額の管理
- ✅ マスタからの保険料率自動取得
- ✅ 計算結果プレビュー表示
- ✅ 本人負担額・会社負担額の集計表示

**関連ファイル**:
- `src/app/pages/premiums/bonus/bonus-premiums.page.ts`（実装済み）
- `src/app/pages/premiums/bonus/bonus-form-dialog.component.ts`（実装済み）
- `src/app/services/bonus-premiums.service.ts`（実装済み）
- `src/app/utils/bonus-calculator.ts`（実装済み）

### (7) 社会保険料自動計算機能（実装済み）

**実装状況**: 計算ロジックと保存機能は実装済み

- ✅ 型定義（MonthlyPremium, PremiumRateContext, MonthlyPremiumCalculationResult）
- ✅ 厚生年金保険料計算ロジック
- ✅ 介護保険料計算ロジック（40〜64歳判定含む）
- ✅ 健康保険料計算ロジック
- ✅ 端数処理の統一（1円未満切り捨て）
- ✅ 計算結果の保存（Firestore）
- ✅ 資格取得日・喪失日ベースの対象月判定
- ✅ 保険料免除（premiumTreatment === 'exempt'）の処理

**関連ファイル**:
- `src/app/utils/premium-calculator.ts`（新規追加）
- `src/app/services/monthly-premiums.service.ts`（新規追加）

### (6) 標準報酬月額・等級・保険プランマスタ管理機能（実装済み）

**実装状況**: マスタ管理機能は実装済み

- ✅ ページコンポーネントとルーティング
- ✅ 型定義（HealthRateTable, CareRateTable, PensionRateTable, StandardRewardBand）
- ✅ マスタ登録・編集画面（健康保険・介護保険・厚生年金）
- ✅ 年度別マスタ管理
- ✅ 協会けんぽの初期値プリセット（都道府県別）
- ✅ 標準報酬等級表の登録・管理
- ✅ 月次保険料計算画面とのマスタ連携
- ⚠️ 等級自動判定機能（報酬月額からの自動判定）は未実装

**関連ファイル**:
- `src/app/pages/masters/masters.page.ts`（実装済み）
- `src/app/services/masters.service.ts`（新規追加）
- `src/app/pages/masters/health-master-form-dialog.component.ts`（新規追加）
- `src/app/pages/masters/care-master-form-dialog.component.ts`（新規追加）
- `src/app/pages/masters/pension-master-form-dialog.component.ts`（新規追加）
- `src/app/utils/kyokai-presets.ts`（新規追加）

### (18) 従業員情報の変更申請・承認（簡易ワークフロー）機能

**実装状況**: ページは存在するが、実装は未完了

- ✅ ページコンポーネントとルーティング
- ✅ 型定義（ChangeRequest）
- ❌ 申請登録画面
- ❌ 承認・却下機能
- ❌ 申請一覧表示

**関連ファイル**:
- `src/app/pages/requests/requests.page.ts`（プレースホルダーのみ）

---

## ❌ 未実装機能

### (4) 被扶養者（家族）管理機能

**実装状況**: 完全に未実装

- ❌ 被扶養者情報の型定義
- ❌ 被扶養者登録・編集画面
- ❌ 資格取得日・喪失日の管理
- ❌ 扶養状況確認機能

### (5) 標準報酬決定・改定履歴管理機能

**実装状況**: 完全に未実装

- ❌ 履歴管理の型定義
- ❌ 履歴登録・閲覧画面
- ❌ 適用開始年月の管理
- ❌ 決定区分の管理

### (13) セキュリティ・アクセス制御機能

**実装状況**: 基本認証のみ、詳細なアクセス制御は未実装

- ✅ Firebase Authenticationによる認証
- ⚠️ Firestoreセキュリティルールは緩い設定（offices配下はログイン済みなら全アクセス可能）
- ❌ ロール別の詳細なアクセス制御
- ❌ 事業所間のデータ分離（ルールレベル）
- ❌ 識別情報のマスキング表示

**関連ファイル**:
- `firestore.rules`（基本的なルールのみ）

### (14) 従業員情報一括インポート機能

**実装状況**: 完全に未実装

- ✅ 型定義（ImportJob）
- ❌ CSVアップロード機能
- ❌ 形式チェック
- ❌ エラー行の確認・修正画面

### (15) 保険料データのCSVエクスポート機能

**実装状況**: 完全に未実装

- ❌ CSV出力機能
- ❌ 月次保険料一覧のエクスポート
- ❌ 従業員台帳のエクスポート
- ❌ 賞与一覧のエクスポート

### (16) 従業員情報の最終更新者・更新日時表示機能

**実装状況**: データ保存と詳細表示は実装済み

- ✅ 更新日時・更新ユーザーIDの保存（employees.service.ts）
- ✅ 詳細ダイアログでの表示（employee-detail-dialog.component.ts）
- ⚠️ 一覧画面での表示は未実装（任意実装）

### (17) 社会保険用語・ルールヘルプ機能

**実装状況**: 完全に未実装

- ❌ ヘルプコンテンツ
- ❌ ヘルプアイコン・モーダル

### (19) 社会保険手続き履歴・期限管理機能

**実装状況**: 完全に未実装

- ❌ 手続き履歴の型定義
- ❌ 手続き登録・閲覧画面
- ❌ 提出期限の自動計算
- ❌ 期限切れアラート

### (20) 被扶養者状況確認・年次見直し支援機能

**実装状況**: 完全に未実装

- ❌ 扶養状況確認の型定義
- ❌ 確認結果の記録機能
- ❌ 基準年月日時点での抽出機能

### (21) 社会保険料納付状況管理機能

**実装状況**: 完全に未実装

- ❌ 納付状況の型定義
- ❌ 納付予定額・実納付額の記録
- ❌ 納付ステータス管理
- ❌ ダッシュボードでの表示

---

## 📊 実装進捗サマリー

| カテゴリ | 実装済み | 部分実装 | 未実装 | 合計 |
|---------|---------|---------|--------|------|
| 基本機能 | 3 | 0 | 0 | 3 |
| 管理機能 | 1 | 2 | 1 | 4 |
| 計算・表示機能 | 6 | 0 | 0 | 6 |
| その他機能 | 0 | 1 | 7 | 8 |
| **合計** | **10** | **3** | **8** | **21** |

**実装率**: 約48%（完全実装のみ） / 約62%（部分実装含む）

**最新更新**: 
- Phase1-2完了により、従業員台帳機能の資格情報・就業状態管理が追加実装されました。
- Phase1-3完了により、社会保険料自動計算機能（premium-calculator.ts）が実装されました。
- Phase1-4完了により、月次保険料一覧・会社負担集計機能が基本実装されました。
- Phase1-5完了により、標準報酬月額・等級・保険プランマスタ管理機能が実装され、月次保険料計算画面がマスタ連携に切り替わりました。
- Phase1-6完了により、賞与管理・賞与保険料計算機能が完全実装されました。標準賞与額の計算、上限チェック、年度内累計管理、マスタ連携による保険料計算が実装されています。
- Phase1-7完了により、マイページ機能が完全実装されました。ログインユーザーが自分の社員情報・月次/賞与保険料を1画面で確認できるようになりました。
- Phase1-8完了により、従業員とユーザーアカウントの自動紐づけ機能が実装されました。事業所設定時に、メールアドレス（contactEmail）が一致する従業員レコードを自動的に検索して紐づけます。
- Phase1-9完了により、月次保険料一覧機能が拡張されました。過去月分の閲覧（年月選択UI、直近12ヶ月対応）、従業員名での絞り込み、月単位の合計行表示が実装されています。
- Phase1-10完了により、負担構成ダッシュボード機能の基本実装が完了しました。従業員数、月次保険料（今月の会社負担額）、トレンド（前月比の変化）の3つのKPIカードが実装されています。
- Phase1-11完了により、保険料シミュレーション機能が完全実装されました。報酬月額や等級を入力して社会保険料を試算できる機能が実装され、既存の月次保険料計算ロジック（`premium-calculator.ts`）を再利用することで、計算結果の整合性が保たれています。

---

## 🔧 技術スタック

- **フレームワーク**: Angular 20.3.0
- **UIライブラリ**: Angular Material 20.2.13
- **バックエンド**: Firebase (Firestore, Authentication)
- **言語**: TypeScript 5.9.2

---

## 📝 次のステップ推奨事項

### 優先度: 高

1. **負担構成ダッシュボード機能（(11)）の拡張（Phase1-12）**
   - グラフ表示（Chart.jsまたはng2-chartsの導入）
   - 過去12ヶ月の推移グラフ（月次保険料の会社負担額推移）
   - 賞与保険料を含めたトータル負担の可視化
   - 従業員別ランキング表示（会社負担額・本人負担額トップ10）
   - 年度別集計表示（4月1日基準）

### 優先度: 中

2. **セキュリティ・アクセス制御（(13)）の強化（Phase1-13）**
   - Firestoreセキュリティルールの詳細化
   - ロール別アクセス制御の実装（画面レベル）
   - 事業所間のデータ分離（ルールレベル）
   - 識別情報のマスキング表示
   - **注意**: 本番環境に向けた必須機能

3. **被扶養者管理機能（(4)）の実装（Phase1-14）**
   - 被扶養者情報の型定義とCRUD機能
   - 従業員との紐づけ
   - 資格取得日・喪失日の管理
   - 年次見直し支援機能

4. **標準報酬決定・改定履歴管理（(5)）の実装**
   - 履歴管理機能の実装
   - 適用開始年月の管理
   - 決定区分の管理

5. **CSVインポート・エクスポート機能（(14), (15)）の実装（Phase1-15）**
   - 従業員情報の一括インポート（CSV）
   - 月次保険料・賞与保険料のエクスポート（CSV）
   - エラー行の確認・修正画面

### 優先度: 低

6. **社会保険手続き履歴管理（(19)）**
   - 手続き履歴の型定義とCRUD機能
   - 提出期限の自動計算
   - 期限切れアラート

7. **納付状況管理（(21)）**
   - 納付状況の型定義とCRUD機能
   - 納付予定額・実納付額の記録
   - 納付ステータス管理

8. **社会保険用語・ルールヘルプ機能（(17)）**
   - ヘルプコンテンツの作成
   - ヘルプアイコン・モーダルの実装

---

## 📌 注意事項

- Firestoreセキュリティルールは現在、`offices`配下のデータに対してログイン済みユーザーなら全アクセス可能な設定になっています。本番環境では、事業所IDとロールに基づいた詳細なアクセス制御が必要です。

- 保険料計算ロジックは、実務上の細かなルール（入社月・退職月の扱い、端数処理など）を簡略化した形で実装する必要があります。カタログの制約条件を参照してください。

- マスタデータ（保険料率・等級表）は、外部サイトからの自動取得ではなく、管理者が手動で更新する運用を前提としています。

