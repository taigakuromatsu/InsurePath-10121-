# Phase1 実装計画

**作成日**: 2025年1月  
**最終更新**: Phase1-12完了後（2025年10月）  
**実装完了日**: 2025年10月

---

## 📊 Phase1の実装方針

Phase1では、**InsurePathの基本機能**を実装しました。社会保険管理システムとして必要不可欠な機能を優先的に実装し、システムの基盤を構築しました。

### Phase1の目標
1. **基本機能の実装**: 事業所管理、従業員台帳、保険料計算の基本機能
2. **計算機能の実装**: 社会保険料自動計算、月次保険料一覧、賞与保険料計算
3. **表示機能の実装**: マイページ、ダッシュボード、シミュレーション機能
4. **マスタ管理機能の実装**: 標準報酬月額・等級・保険プランマスタ管理

### 実装期間
- **開始日**: 2025年1月
- **完了日**: 2025年10月
- **実装期間**: 約10ヶ月間

---

## 📋 Phase1の実装フェーズ

### Phase1-1: プロジェクト初期設定 ✅ 完了

**優先度**: 🔴 最高（プロジェクト基盤）  
**推定工数**: 低（1週間）  
**推定期間**: 1週間  
**依存関係**: なし  
**実装完了日**: 2025年1月

**目的**: InsurePathプロジェクトの初期設定と基盤構築

**実装内容**:
1. **プロジェクトセットアップ** ✅
   - ✅ Angularプロジェクトの作成
   - ✅ Firebaseプロジェクトの設定
   - ✅ Firestoreデータベースの初期設定
   - ✅ Firebase Authenticationの設定

2. **基本構造の構築** ✅
   - ✅ ルーティング設定
   - ✅ 基本レイアウト（サイドメニュー、ヘッダー）
   - ✅ Angular Materialの導入

**実装されたファイル**:
- ✅ `angular.json`（プロジェクト設定）
- ✅ `firebase.json`（Firebase設定）
- ✅ `firestore.rules`（初期セキュリティルール）
- ✅ `src/app/app.routes.ts`（ルーティング設定）
- ✅ `src/app/app.ts`（メインコンポーネント）

---

### Phase1-2: 従業員台帳機能の資格情報・就業状態管理 ✅ 完了

**優先度**: 🔴 最高（基本機能）  
**推定工数**: 中（2-3週間）  
**推定期間**: 2-3週間  
**依存関係**: Phase1-1  
**実装完了日**: 2025年1月

**目的**: 従業員の基本情報と資格情報・就業状態を管理できる機能を実装する

**実装内容**:
1. **従業員情報の型定義** ✅
   - ✅ `Employee`型の定義（基本情報、雇用区分、報酬月額、資格情報、就業状態など）
   - ✅ Firestoreコレクション構造の設計（`offices/{officeId}/employees/{employeeId}`）

2. **従業員台帳のCRUD機能** ✅
   - ✅ 従業員一覧表示（`employees.page.ts`）
   - ✅ 従業員登録・編集ダイアログ（`employee-form-dialog.component.ts`）
   - ✅ 従業員詳細ダイアログ（`employee-detail-dialog.component.ts`）
   - ✅ 従業員削除機能

3. **資格情報の管理** ✅
   - ✅ 健康保険・厚生年金の資格取得日・資格喪失日の管理
   - ✅ 資格取得区分・資格喪失理由区分の管理
   - ✅ 被保険者記号・番号の管理

4. **就業状態の管理** ✅
   - ✅ 就業状態（通常勤務／産前産後休業／育児休業／傷病休職など）の管理
   - ✅ 就業状態の開始日・終了日の管理
   - ✅ 保険料の扱い（通常徴収／免除）の管理

5. **自動判定機能** ✅
   - ✅ 入社日・退職日・資格取得日・資格喪失日に基づく対象月の自動判定
   - ✅ 年齢から介護保険の第2号被保険者（40〜64歳）の自動判定

**実装されたファイル**:
- ✅ `src/app/types.ts`（`Employee`型、`EmploymentType`型、`InsuranceQualificationKind`型、`InsuranceLossReasonKind`型、`WorkingStatus`型、`PremiumTreatment`型追加）
- ✅ `src/app/services/employees.service.ts`（新規作成）
- ✅ `src/app/pages/employees/employees.page.ts`（新規作成）
- ✅ `src/app/pages/employees/employee-form-dialog.component.ts`（新規作成）
- ✅ `src/app/pages/employees/employee-detail-dialog.component.ts`（新規作成）
- ✅ `src/app/utils/label-utils.ts`（ラベル変換ユーティリティ、新規作成）

**技術要件**:
- ✅ Firestoreコレクション設計
- ✅ Reactive Formsによるフォーム管理
- ✅ Angular Material Dialogの活用
- ✅ 日付計算ロジック

**注意事項**:
- ✅ 入社月・退職月・資格取得月・資格喪失月の扱いは簡略化したルールに従う
- ✅ 介護保険の対象判定は年齢（生年月日）から自動判定

---

### Phase1-3: 社会保険料自動計算機能 ✅ 完了

**優先度**: 🔴 最高（核心機能）  
**推定工数**: 高（3-4週間）  
**推定期間**: 3-4週間  
**依存関係**: Phase1-2  
**実装完了日**: 2025年1月

**目的**: 従業員の標準報酬月額と保険料率マスタから、健康保険・介護保険・厚生年金の保険料を自動計算する機能を実装する

**実装内容**:
1. **計算ロジックの実装** ✅
   - ✅ 厚生年金保険料の計算（標準報酬月額 × 厚生年金保険料率 ÷ 2）
   - ✅ 介護保険料の計算（40〜64歳のみ、標準報酬月額 × 介護保険料率 ÷ 2）
   - ✅ 健康保険料の計算（標準報酬月額 × 健康保険料率 ÷ 2）
   - ✅ 端数処理の統一（1円未満切り捨て）

2. **計算結果の型定義** ✅
   - ✅ `MonthlyPremium`型の定義
   - ✅ `PremiumRateContext`型の定義
   - ✅ `MonthlyPremiumCalculationResult`型の定義

3. **計算サービスの実装** ✅
   - ✅ `premium-calculator.ts`の実装（計算ロジック）
   - ✅ `monthly-premiums.service.ts`の実装（Firestoreへの保存）

4. **資格期間の考慮** ✅
   - ✅ 資格取得日・喪失日ベースの対象月判定
   - ✅ 保険料免除（`premiumTreatment === 'exempt'`）の処理

**実装されたファイル**:
- ✅ `src/app/types.ts`（`MonthlyPremium`型、`PremiumRateContext`型、`MonthlyPremiumCalculationResult`型追加）
- ✅ `src/app/utils/premium-calculator.ts`（新規作成）
- ✅ `src/app/services/monthly-premiums.service.ts`（新規作成）

**技術要件**:
- ✅ 保険料計算ロジックの実装
- ✅ 端数処理の統一
- ✅ 資格期間の考慮

**注意事項**:
- ✅ 計算ロジックは簡略化したルールに従う（実務上の細かな例外ケースには対応しない）
- ✅ 端数処理はシステム内で統一（1円未満切り捨て）

---

### Phase1-4: 月次保険料一覧・会社負担集計機能（基本実装） ✅ 完了

**優先度**: 🔴 最高（基本機能）  
**推定工数**: 中（2-3週間）  
**推定期間**: 2-3週間  
**依存関係**: Phase1-3  
**実装完了日**: 2025年1月

**目的**: 対象年月を指定すると、その事業所に所属する従業員の社会保険料を表計算シートのような一覧画面で表示し、会社負担額を集計する機能を実装する

**実装内容**:
1. **月次保険料一覧画面** ✅
   - ✅ ページコンポーネントとルーティング（`monthly-premiums.page.ts`）
   - ✅ 対象年月の選択UI
   - ✅ 一覧表示（Material Table）
   - ✅ 列の表示（氏名、雇用区分、報酬月額、健保等級、厚年等級、各保険の本人負担・会社負担・合計、合計本人負担額・合計会社負担額）

2. **会社負担集計機能** ✅
   - ✅ 事業所全体の会社負担額総計の自動集計
   - ✅ 合計行の表示

3. **計算・保存機能** ✅
   - ✅ 一括計算・保存機能
   - ✅ 既存データの上書き確認

**実装されたファイル**:
- ✅ `src/app/pages/premiums/monthly/monthly-premiums.page.ts`（新規作成）
- ✅ `src/app/services/monthly-premiums.service.ts`（拡張）

**技術要件**:
- ✅ Angular Material Tableの活用
- ✅ Observableストリームによるデータ管理
- ✅ 集計ロジックの実装

**注意事項**:
- ✅ 表示される一覧は、ログインユーザーの所属事業所のデータのみを対象とする
- ✅ `isInsured = true`の従業員のみを対象とする

---

### Phase1-5: 標準報酬月額・等級・保険プランマスタ管理機能 ✅ 完了

**優先度**: 🔴 最高（基本機能）  
**推定工数**: 高（3-4週間）  
**推定期間**: 3-4週間  
**依存関係**: Phase1-3  
**実装完了日**: 2025年1月

**目的**: 健康保険・介護保険・厚生年金について、等級ごとの標準報酬月額および保険料率を事業所単位のマスタとして登録・編集できる機能を実装する

**実装内容**:
1. **マスタの型定義** ✅
   - ✅ `HealthRateTable`型の定義（健康保険料率マスタ）
   - ✅ `CareRateTable`型の定義（介護保険料率マスタ）
   - ✅ `PensionRateTable`型の定義（厚生年金保険料率マスタ）
   - ✅ `StandardRewardBand`型の定義（標準報酬等級表）

2. **マスタ管理画面** ✅
   - ✅ ページコンポーネントとルーティング（`masters.page.ts`）
   - ✅ 健康保険マスタの登録・編集ダイアログ（`health-master-form-dialog.component.ts`）
   - ✅ 介護保険マスタの登録・編集ダイアログ（`care-master-form-dialog.component.ts`）
   - ✅ 厚生年金マスタの登録・編集ダイアログ（`pension-master-form-dialog.component.ts`）

3. **協会けんぽの初期値プリセット** ✅
   - ✅ 都道府県別の健康保険料率のプリセット（`kyokai-presets.ts`）
   - ✅ 初期状態で現在年度の料率・等級表をプリセット

4. **マスタサービスの実装** ✅
   - ✅ `masters.service.ts`の実装（Firestoreへの保存・取得）

5. **月次保険料計算画面との連携** ✅
   - ✅ マスタからの保険料率自動取得
   - ✅ 適用料率の表示

**実装されたファイル**:
- ✅ `src/app/types.ts`（`HealthRateTable`型、`CareRateTable`型、`PensionRateTable`型、`StandardRewardBand`型追加）
- ✅ `src/app/services/masters.service.ts`（新規作成）
- ✅ `src/app/pages/masters/masters.page.ts`（新規作成）
- ✅ `src/app/pages/masters/health-master-form-dialog.component.ts`（新規作成）
- ✅ `src/app/pages/masters/care-master-form-dialog.component.ts`（新規作成）
- ✅ `src/app/pages/masters/pension-master-form-dialog.component.ts`（新規作成）
- ✅ `src/app/utils/kyokai-presets.ts`（協会けんぽプリセット、新規作成）

**技術要件**:
- ✅ Firestoreコレクション設計
- ✅ 年度別マスタ管理
- ✅ プリセットデータの管理

**注意事項**:
- ✅ 協会けんぽ・厚生年金ともに、外部サイトからの自動取得は行わず、管理者がマスタ画面で料率・等級表を変更する運用とする
- ✅ 保険料率および標準報酬月額には「適用開始年月（年度）」を持たせ、年度ごとの改定にマスタ更新で対応できる設計とする

---

### Phase1-6: 賞与管理・賞与保険料計算機能 ✅ 完了

**優先度**: 🟡 高（実務上必要な機能）  
**推定工数**: 中（2-3週間）  
**推定期間**: 2-3週間  
**依存関係**: Phase1-3、Phase1-5  
**実装完了日**: 2025年1月

**目的**: 従業員ごとの賞与支給履歴を登録・閲覧し、賞与にかかる社会保険料を自動計算する機能を実装する

**実装内容**:
1. **賞与情報の型定義** ✅
   - ✅ `BonusPremium`型の定義（支給日、支給額、標準賞与額、保険料など）
   - ✅ Firestoreコレクション構造の設計（`offices/{officeId}/bonusPremiums/{bonusId}`）

2. **賞与登録・閲覧画面** ✅
   - ✅ ページコンポーネントとルーティング（`bonus-premiums.page.ts`）
   - ✅ 賞与登録・編集ダイアログ（`bonus-form-dialog.component.ts`）
   - ✅ 賞与一覧表示（Material Table）

3. **標準賞与額の計算** ✅
   - ✅ 賞与支給額から1,000円未満を切り捨てた額を「標準賞与額」として決定
   - ✅ 上限チェック（健康保険573万円/年度累計、厚生年金150万円/回）

4. **賞与保険料の計算** ✅
   - ✅ 健康保険・厚生年金の賞与にかかる保険料の自動計算
   - ✅ 本人負担分・会社負担分の計算
   - ✅ 年度（4月1日基準）の自動判定
   - ✅ 健康保険の年度内累計標準賞与額の管理

5. **マスタ連携** ✅
   - ✅ マスタからの保険料率自動取得
   - ✅ 計算結果プレビュー表示

**実装されたファイル**:
- ✅ `src/app/types.ts`（`BonusPremium`型追加）
- ✅ `src/app/services/bonus-premiums.service.ts`（新規作成）
- ✅ `src/app/pages/premiums/bonus/bonus-premiums.page.ts`（新規作成）
- ✅ `src/app/pages/premiums/bonus/bonus-form-dialog.component.ts`（新規作成）
- ✅ `src/app/utils/bonus-calculator.ts`（賞与保険料計算ロジック、新規作成）

**技術要件**:
- ✅ Firestoreコレクション設計
- ✅ 年度判定ロジック（4月1日基準）
- ✅ 上限チェックロジック
- ✅ 年度内累計管理

**注意事項**:
- ✅ 賞与の定義は協会けんぽの定義に従う（年3回以下支給されるもの）
- ✅ 健康保険の年度内累計標準賞与額は573万円を上限とする
- ✅ 厚生年金の1回あたりの標準賞与額は150万円を上限とする

---

### Phase1-7: マイページ機能 ✅ 完了

**優先度**: 🟡 高（ユーザビリティ向上）  
**推定工数**: 中（1-2週間）  
**推定期間**: 1-2週間  
**依存関係**: Phase1-3、Phase1-6  
**実装完了日**: 2025年1月

**目的**: ログインした一般従業員が、自分が所属する事業所における自分自身の保険料明細のみを閲覧できる機能を実装する

**実装内容**:
1. **マイページ画面** ✅
   - ✅ ページコンポーネントとルーティング（`my-page.ts`）
   - ✅ 基本情報の表示（氏名、所属部署、入社日、等級・標準報酬月額、社会保険加入状況）

2. **月次保険料明細の表示** ✅
   - ✅ 直近12ヶ月分の月次保険料明細の表示
   - ✅ 本人負担額・会社負担額・合計額の表示

3. **賞与保険料明細の表示** ✅
   - ✅ 賞与保険料明細の表示
   - ✅ 本人負担額・会社負担額の表示

4. **セキュリティ** ✅
   - ✅ 従業員IDによる自動フィルタリング（自分のデータのみ閲覧可能）
   - ✅ 空データ時の適切なメッセージ表示

**実装されたファイル**:
- ✅ `src/app/pages/me/my-page.ts`（新規作成）
- ✅ `src/app/services/monthly-premiums.service.ts`（`listByOfficeAndEmployee`メソッド追加）

**技術要件**:
- ✅ 従業員IDによるデータフィルタリング
- ✅ Observableストリームによるデータ管理

**注意事項**:
- ✅ 従業員本人のデータのみを表示する（セキュリティ確保）
- ⚠️ 推移グラフは未実装（将来の拡張として検討）

---

### Phase1-8: 従業員とユーザーアカウントの自動紐づけ機能 ✅ 完了

**優先度**: 🟡 中（ユーザビリティ向上）  
**推定工数**: 低（1週間）  
**推定期間**: 1週間  
**依存関係**: Phase1-2  
**実装完了日**: 2025年1月

**目的**: 事業所設定時に、メールアドレス（`contactEmail`）が一致する従業員レコードを自動的に検索して紐づける機能を実装する

**実装内容**:
1. **自動紐づけロジック** ✅
   - ✅ 事業所設定時に、メールアドレス（`contactEmail`）が一致する従業員レコードを自動検索
   - ✅ 一致する従業員レコードが見つかった場合、`employeeId`を自動設定

2. **ユーザープロファイルの更新** ✅
   - ✅ `current-user.service.ts`の`assignOffice`メソッドで自動紐づけ機能を実装
   - ✅ メールアドレスによる従業員レコードの自動検索機能

**実装されたファイル**:
- ✅ `src/app/services/current-user.service.ts`（`assignOffice`メソッド拡張）
- ✅ `src/app/services/employees.service.ts`（メールアドレス検索メソッド追加）

**技術要件**:
- ✅ Firestoreクエリによる従業員レコード検索
- ✅ メールアドレスの一致判定

**注意事項**:
- ✅ メールアドレスが一致しない場合は、`employeeId`は設定されない（後から手動で設定可能）
- ✅ 複数の従業員レコードが一致する場合は、最初に見つかったレコードを使用

---

### Phase1-9: 月次保険料一覧機能の拡張（過去月分閲覧、絞り込み、合計行） ✅ 完了

**優先度**: 🟡 中（ユーザビリティ向上）  
**推定工数**: 中（1-2週間）  
**推定期間**: 1-2週間  
**依存関係**: Phase1-4  
**実装完了日**: 2025年1月

**目的**: 月次保険料一覧機能を拡張し、過去月分の閲覧、従業員名での絞り込み、月単位の合計行表示を実装する

**実装内容**:
1. **過去月分の閲覧機能** ✅
   - ✅ 年月選択UI（年月ピッカー）
   - ✅ 直近12ヶ月分のデータを閲覧可能
   - ✅ 初期表示で当月分を自動ロード

2. **絞り込み機能** ✅
   - ✅ 従業員名での絞り込み機能（テキスト入力）
   - ✅ リアルタイムフィルタリング

3. **合計行表示** ✅
   - ✅ 月単位の合計行表示（本人負担・会社負担）
   - ✅ 合計行のハイライト表示

**実装されたファイル**:
- ✅ `src/app/pages/premiums/monthly/monthly-premiums.page.ts`（機能拡張）

**技術要件**:
- ✅ Angular Material DatePickerの活用
- ✅ Signalによるリアルタイムフィルタリング
- ✅ 集計ロジックの実装

**注意事項**:
- ✅ 過去月分のデータは、既に計算・保存されているデータを表示する（再計算は行わない）
- ✅ 絞り込みはクライアント側で実施（大量データの場合はサーバー側フィルタリングを検討）

---

### Phase1-10: 負担構成ダッシュボード機能（基本実装） ✅ 完了

**優先度**: 🟡 中（ユーザビリティ向上）  
**推定工数**: 中（2週間）  
**推定期間**: 2週間  
**依存関係**: Phase1-4、Phase1-6  
**実装完了日**: 2025年1月

**目的**: 事業所ごとの社会保険料について、KPIカードで主要指標を表示するダッシュボード機能を実装する

**実装内容**:
1. **ダッシュボード画面** ✅
   - ✅ ページコンポーネントとルーティング（`dashboard.page.ts`）
   - ✅ KPIカードの表示

2. **KPIカードの実装** ✅
   - ✅ 従業員数カード（社会保険加入者数または全従業員数）
   - ✅ 月次保険料カード（今月の会社負担額合計）
   - ✅ トレンドカード（前月比の変化、増減率%）

3. **データ取得と集計ロジック** ✅
   - ✅ 従業員数の集計
   - ✅ 月次保険料の集計
   - ✅ 前月比の計算

**実装されたファイル**:
- ✅ `src/app/pages/dashboard/dashboard.page.ts`（新規作成）

**技術要件**:
- ✅ Observableストリームによるデータ管理
- ✅ 集計ロジックの実装
- ✅ 前月比計算ロジック

**注意事項**:
- ✅ ダッシュボードに表示される集計は、ログインユーザーの所属事業所のデータのみを集計対象とする
- ✅ エラーハンドリングとデータなし時の表示を実装

---

### Phase1-11: 保険料シミュレーション機能 ✅ 完了

**優先度**: 🟡 中（ユーザビリティ向上）  
**推定工数**: 中（1-2週間）  
**推定期間**: 1-2週間  
**依存関係**: Phase1-3、Phase1-5  
**実装完了日**: 2025年1月

**目的**: 想定月給（報酬月額）を入力すると、等級マスタから該当する等級と標準報酬月額を判定し、健康保険・介護保険・厚生年金それぞれの試算ベースの本人負担額・会社負担額を算出して表示する機能を実装する

**実装内容**:
1. **シミュレーション画面** ✅
   - ✅ ページコンポーネントとルーティング（`simulator.page.ts`）
   - ✅ 入力フォーム（対象年月、報酬月額、健康保険等級、厚生年金等級、介護保険対象フラグ）

2. **シミュレーション計算ロジック** ✅
   - ✅ `premium-calculator.ts`を再利用してシミュレーション計算
   - ✅ 等級マスタからの標準報酬月額自動判定
   - ✅ 結果表示（等級・標準報酬月額、各保険の本人負担額・会社負担額・合計、トータル）

3. **マスタ連携** ✅
   - ✅ マスタからの保険料率自動取得
   - ✅ エラーハンドリング（マスタ未設定、料率未設定など）

**実装されたファイル**:
- ✅ `src/app/pages/simulator/simulator.page.ts`（新規作成）
- ✅ `src/app/utils/premium-calculator.ts`（再利用）

**技術要件**:
- ✅ 既存の計算ロジックの再利用
- ✅ マスタデータの取得
- ✅ エラーハンドリング

**注意事項**:
- ✅ 既存の月次保険料計算ロジック（`premium-calculator.ts`）を再利用することで、計算結果の整合性を保つ
- ✅ 一般従業員も、自分の所属事業所のマスタに基づいたシミュレーションを利用できる

---

### Phase1-12: 負担構成ダッシュボード機能の拡張（グラフ表示） ✅ 完了

**優先度**: 🟡 中（ユーザビリティ向上）  
**推定工数**: 中（2週間）  
**推定期間**: 2週間  
**依存関係**: Phase1-10  
**実装完了日**: 2025年1月

**目的**: 負担構成ダッシュボード機能を拡張し、グラフ表示による視覚的な分析機能を追加する

**実装内容**:
1. **グラフ表示機能** ✅
   - ✅ 過去12ヶ月の推移グラフ（折れ線グラフ、月次保険料の会社負担額推移）
   - ✅ 当月の月次・賞与比較グラフ（棒グラフ）
   - ✅ 年度別集計グラフ（棒グラフ、4月1日基準）

2. **従業員別ランキング表示** ✅
   - ✅ 会社負担額トップ10の表示
   - ✅ 本人負担額トップ10の表示

3. **グラフライブラリの導入** ✅
   - ✅ ng2-charts（Chart.js）の導入と設定

**実装されたファイル**:
- ✅ `src/app/pages/dashboard/dashboard.page.ts`（グラフ表示機能追加）

**技術要件**:
- ✅ ng2-charts（Chart.js）の活用
- ✅ グラフデータの集計ロジック
- ✅ 年度判定ロジック（4月1日基準）

**注意事項**:
- ✅ グラフ表示は大量データの場合でもパフォーマンスを考慮
- ✅ データなし時の適切な表示を実装

---

## 📅 Phase1の推奨実装順序

### 第1段階（基盤構築）
1. **Phase1-1: プロジェクト初期設定** ✅ 完了
   - プロジェクトの基盤構築
   - 推定期間: 1週間

### 第2段階（基本機能）
2. **Phase1-2: 従業員台帳機能の資格情報・就業状態管理** ✅ 完了
   - 基本機能の実装
   - 推定期間: 2-3週間

3. **Phase1-3: 社会保険料自動計算機能** ✅ 完了
   - 核心機能の実装
   - 推定期間: 3-4週間

4. **Phase1-4: 月次保険料一覧・会社負担集計機能（基本実装）** ✅ 完了
   - 基本機能の実装
   - 推定期間: 2-3週間

### 第3段階（マスタ管理）
5. **Phase1-5: 標準報酬月額・等級・保険プランマスタ管理機能** ✅ 完了
   - マスタ管理機能の実装
   - 推定期間: 3-4週間

### 第4段階（拡張機能）
6. **Phase1-6: 賞与管理・賞与保険料計算機能** ✅ 完了
   - 実務上必要な機能
   - 推定期間: 2-3週間

7. **Phase1-7: マイページ機能** ✅ 完了
   - ユーザビリティ向上
   - 推定期間: 1-2週間

8. **Phase1-8: 従業員とユーザーアカウントの自動紐づけ機能** ✅ 完了
   - ユーザビリティ向上
   - 推定期間: 1週間

### 第5段階（機能拡張）
9. **Phase1-9: 月次保険料一覧機能の拡張** ✅ 完了
   - ユーザビリティ向上
   - 推定期間: 1-2週間

10. **Phase1-10: 負担構成ダッシュボード機能（基本実装）** ✅ 完了
    - ユーザビリティ向上
    - 推定期間: 2週間

11. **Phase1-11: 保険料シミュレーション機能** ✅ 完了
    - ユーザビリティ向上
    - 推定期間: 1-2週間

12. **Phase1-12: 負担構成ダッシュボード機能の拡張（グラフ表示）** ✅ 完了
    - ユーザビリティ向上
    - 推定期間: 2週間

---

## 🔍 各フェーズの詳細検討事項

### Phase1-2（従業員台帳）
- ✅ **データモデル**: 従業員情報の構造設計（基本情報、資格情報、就業状態）
- ✅ **資格管理**: 資格取得・喪失日の管理ロジック
- ✅ **自動判定**: 対象月の自動判定ロジック

### Phase1-3（保険料計算）
- ✅ **計算ロジック**: 各保険の保険料計算ロジックの実装
- ✅ **端数処理**: 端数処理の統一（1円未満切り捨て）
- ✅ **資格期間**: 資格取得日・喪失日ベースの対象月判定

### Phase1-4（月次保険料一覧）
- ✅ **一覧表示**: Material Tableによる一覧表示
- ✅ **集計機能**: 会社負担額総計の自動集計
- ✅ **計算・保存**: 一括計算・保存機能

### Phase1-5（マスタ管理）
- ✅ **マスタ設計**: 年度別マスタ管理の設計
- ✅ **プリセット**: 協会けんぽの初期値プリセット
- ✅ **連携**: 月次保険料計算画面とのマスタ連携

### Phase1-6（賞与管理）
- ✅ **標準賞与額**: 1,000円未満切り捨てロジック
- ✅ **上限チェック**: 健康保険573万円/年度累計、厚生年金150万円/回
- ✅ **年度判定**: 4月1日基準の年度判定

### Phase1-7（マイページ）
- ✅ **セキュリティ**: 従業員IDによる自動フィルタリング
- ✅ **データ表示**: 月次・賞与保険料明細の表示

### Phase1-8（自動紐づけ）
- ✅ **検索ロジック**: メールアドレスによる従業員レコード検索
- ✅ **自動設定**: `employeeId`の自動設定

### Phase1-9（月次保険料一覧拡張）
- ✅ **過去月分閲覧**: 年月選択UI、直近12ヶ月対応
- ✅ **絞り込み**: 従業員名での絞り込み機能
- ✅ **合計行**: 月単位の合計行表示

### Phase1-10（ダッシュボード基本）
- ✅ **KPIカード**: 従業員数、月次保険料、トレンドカード
- ✅ **集計ロジック**: データ取得と集計ロジック

### Phase1-11（シミュレーション）
- ✅ **計算ロジック**: 既存の`premium-calculator.ts`を再利用
- ✅ **マスタ連携**: マスタからの保険料率自動取得

### Phase1-12（ダッシュボード拡張）
- ✅ **グラフ表示**: ng2-charts（Chart.js）を使用したグラフ表示
- ✅ **ランキング**: 従業員別ランキング表示

---

## 📌 注意事項

- **段階的な実装**: Phase1は段階的に実装し、各フェーズ完了後にテストを実施
- **既存機能への影響**: 各フェーズの実装により、既存機能への影響を最小限に抑える
- **テストの重要性**: 特に保険料計算ロジックでは、計算結果の正確性を十分にテスト
- **マスタデータ**: マスタデータは外部サイトからの自動取得ではなく、管理者が手動で更新する運用を前提とする

---

## 🚀 Phase1以降の展望

Phase1完了後、以下の機能をPhase2として実装：

1. **セキュリティ・アクセス制御の強化（Phase2-1）**
   - Firestoreセキュリティルールの詳細化
   - Angular側の`roleGuard`実装

2. **ロール割り当てとユーザー管理の改善（Phase2-2）**
   - 初回ログイン時のロール初期化
   - 新規オフィス作成時の初代admin設定

3. **被扶養者管理機能の実装（Phase2-3）**
   - 被扶養者情報の型定義とCRUD機能

4. **その他の実務機能（Phase2-4以降）**
   - 扶養家族管理の導線改善
   - 標準報酬履歴管理
   - CSVインポート・エクスポート機能

詳細は`IMPLEMENTATION_PLAN_PHASE2.md`を参照してください。

---

以上でPhase1の実装計画は完了です。Phase1は2025年10月に完了し、InsurePathの基本機能が実装されました。

