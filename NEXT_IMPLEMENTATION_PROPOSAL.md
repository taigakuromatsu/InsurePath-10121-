# 次の実装フェーズ提案

**作成日**: 2025年11月  
**最終更新**: Phase1-10完了後

---

## 📊 現在の実装状況

### 完了したフェーズ
- ✅ **Phase1-2**: 従業員台帳機能の資格情報・就業状態管理
- ✅ **Phase1-3**: 社会保険料自動計算機能
- ✅ **Phase1-4**: 月次保険料一覧・会社負担集計機能（基本実装）
- ✅ **Phase1-5**: 標準報酬月額・等級・保険プランマスタ管理機能
- ✅ **Phase1-6**: 賞与管理・賞与保険料計算機能
- ✅ **Phase1-7**: マイページ機能
- ✅ **Phase1-8**: 従業員とユーザーアカウントの自動紐づけ機能
- ✅ **Phase1-9**: 月次保険料一覧機能の拡張（過去月分閲覧、絞り込み、合計行）
- ✅ **Phase1-10**: 負担構成ダッシュボード機能（基本実装）

### 実装率
- **完全実装**: 約43%（9/21機能）
- **部分実装含む**: 約57%（12/21機能）

---

## 🎯 次の実装フェーズ提案

### Phase1-11: 負担構成ダッシュボード機能の拡張（グラフ表示）

**優先度**: 高  
**推定工数**: 中

**目的**: Phase1-10で実装した基本KPIカードに加えて、視覚的な分析機能を追加する

**実装内容**:
1. **過去12ヶ月の推移グラフ**
   - Chart.jsまたはng2-chartsを使用
   - 月次保険料の会社負担額推移を折れ線グラフで表示
   - 月次保険料と賞与保険料を分けて表示（オプション）

2. **賞与保険料を含めたトータル負担の可視化**
   - 当月の賞与保険料の会社負担額合計を追加表示
   - 月次保険料と賞与保険料の合計を表示

3. **従業員別ランキング**
   - 会社負担額が多い従業員トップ10を表示
   - 本人負担額が多い従業員トップ10を表示

4. **年度別集計**
   - 年度（4月1日基準）ごとの集計を表示
   - 月次保険料と賞与保険料の合計を表示

**関連ファイル**:
- `src/app/pages/dashboard/dashboard.page.ts`（拡張）
- `src/app/services/bonus-premiums.service.ts`（集計メソッド追加）

**技術要件**:
- Chart.jsまたはng2-chartsの導入
- データ集計ロジックの追加
- レスポンシブデザインの維持

---

### Phase1-12: 保険料シミュレーション機能の実装

**優先度**: 高  
**推定工数**: 中

**目的**: 報酬月額や等級を入力して、保険料を試算できる機能を実装する

**実装内容**:
1. **入力フォーム**
   - 報酬月額の入力
   - 等級の選択（または自動判定）
   - 対象年月の選択
   - 介護保険対象年齢の設定

2. **シミュレーション計算**
   - `premium-calculator.ts`のロジックを再利用
   - 健康保険・介護保険・厚生年金の保険料を計算
   - 本人負担・会社負担を表示

3. **結果表示**
   - 計算結果の詳細表示
   - 複数シナリオの比較表示（オプション）
   - CSVエクスポート（オプション）

**関連ファイル**:
- `src/app/pages/simulator/simulator.page.ts`（実装）
- `src/app/utils/premium-calculator.ts`（再利用）

**技術要件**:
- 既存の計算ロジックの再利用
- リアクティブフォームの活用
- 結果の視覚的な表示

---

### Phase1-13: セキュリティ・アクセス制御の強化

**優先度**: 中  
**推定工数**: 高

**目的**: Firestoreセキュリティルールと画面レベルのアクセス制御を強化する

**実装内容**:
1. **Firestoreセキュリティルールの詳細化**
   - 事業所IDに基づくデータ分離
   - ロール別のアクセス制御
   - 読み取り・書き込み権限の細分化

2. **画面レベルのアクセス制御**
   - ロール別のメニュー表示制御
   - 機能へのアクセス制限
   - エラーメッセージの適切な表示

3. **識別情報のマスキング表示**
   - 個人情報の一部マスキング
   - 権限に応じた表示制御

**関連ファイル**:
- `firestore.rules`（拡張）
- `src/app/guards/auth.guard.ts`（拡張）
- `src/app/guards/office.guard.ts`（拡張）
- 各ページコンポーネント（アクセス制御追加）

**技術要件**:
- Firestoreセキュリティルールの理解
- Angular Guardsの活用
- ロール管理の実装

---

### Phase1-14: 被扶養者管理機能の実装

**優先度**: 中  
**推定工数**: 中

**目的**: 従業員の被扶養者情報を管理できる機能を実装する

**実装内容**:
1. **被扶養者情報の型定義**
   - `Dependent`型の定義
   - Firestoreコレクション構造の設計

2. **被扶養者登録・編集画面**
   - 基本情報の入力（氏名、続柄、生年月日など）
   - 資格取得日・喪失日の管理
   - 従業員との紐づけ

3. **被扶養者一覧表示**
   - 従業員別の被扶養者一覧
   - 資格状況の表示

**関連ファイル**:
- `src/app/types.ts`（型定義追加）
- `src/app/services/dependents.service.ts`（新規）
- `src/app/pages/dependents/dependents.page.ts`（新規）
- `src/app/pages/dependents/dependent-form-dialog.component.ts`（新規）

**技術要件**:
- Firestoreコレクション設計
- 従業員とのリレーション管理
- 資格取得・喪失日の管理ロジック

---

### Phase1-15: CSVインポート・エクスポート機能の実装

**優先度**: 中  
**推定工数**: 中

**目的**: 従業員情報や保険料データの一括インポート・エクスポート機能を実装する

**実装内容**:
1. **CSVエクスポート機能**
   - 月次保険料一覧のエクスポート
   - 従業員台帳のエクスポート
   - 賞与一覧のエクスポート

2. **CSVインポート機能**
   - 従業員情報の一括インポート
   - 形式チェック
   - エラー行の確認・修正画面

**関連ファイル**:
- `src/app/utils/csv-export.service.ts`（新規）
- `src/app/utils/csv-import.service.ts`（新規）
- `src/app/pages/import/import.page.ts`（実装）

**技術要件**:
- CSVパーサーライブラリの活用
- エラーハンドリング
- 進捗表示

---

## 📋 推奨実装順序

### 短期（1-2ヶ月）
1. **Phase1-11**: 負担構成ダッシュボード機能の拡張（グラフ表示）
   - ユーザー価値が高く、既存機能の自然な拡張
   - 技術的難易度は中程度

2. **Phase1-12**: 保険料シミュレーション機能の実装
   - 既存の計算ロジックを再利用できるため実装が容易
   - ユーザー価値が高い

### 中期（3-4ヶ月）
3. **Phase1-13**: セキュリティ・アクセス制御の強化
   - 本番環境に向けた必須機能
   - 技術的難易度は高いが、セキュリティ上重要

4. **Phase1-14**: 被扶養者管理機能の実装
   - 実務上必要な機能
   - 技術的難易度は中程度

### 長期（5-6ヶ月以降）
5. **Phase1-15**: CSVインポート・エクスポート機能の実装
   - 運用効率化のための機能
   - 技術的難易度は中程度

---

## 🔍 各フェーズの詳細検討事項

### Phase1-11（ダッシュボード拡張）
- **グラフライブラリの選定**: Chart.js vs ng2-charts vs Angular Material Charts
- **パフォーマンス**: 大量データの集計・表示時の最適化
- **UI/UX**: グラフの見やすさと操作性

### Phase1-12（シミュレーション）
- **計算ロジックの再利用**: `premium-calculator.ts`の拡張性
- **シナリオ比較**: 複数シナリオの保存・比較機能の必要性
- **エクスポート**: シミュレーション結果のエクスポート形式

### Phase1-13（セキュリティ）
- **ルール設計**: Firestoreセキュリティルールの複雑さ
- **テスト**: セキュリティルールのテスト方法
- **移行**: 既存データへの影響

### Phase1-14（被扶養者管理）
- **データモデル**: 被扶養者情報の構造設計
- **資格管理**: 資格取得・喪失日の管理ロジック
- **年次見直し**: 年次見直し支援機能の必要性

### Phase1-15（CSV機能）
- **形式定義**: CSV形式の仕様定義
- **エラーハンドリング**: インポート時のエラー処理
- **バリデーション**: データ整合性チェック

---

## 📌 注意事項

- 各フェーズは独立して実装可能ですが、Phase1-13（セキュリティ）は本番環境に向けた必須機能です
- Phase1-11とPhase1-12は、既存機能の拡張・活用が中心のため、比較的実装が容易です
- Phase1-14とPhase1-15は、新規機能の実装となるため、設計段階での十分な検討が必要です

---

以上で次の実装フェーズ提案は完了です。各フェーズの詳細な実装指示書は、実装開始前に作成することを推奨します。
