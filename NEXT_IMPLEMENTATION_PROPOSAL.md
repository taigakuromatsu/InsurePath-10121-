# 次の実装フェーズ提案

**作成日**: 2025年11月  
**最終更新**: Phase1-12完了後

---

## 📊 現在の実装状況

### 完了したフェーズ
- ✅ **Phase1-2**: 従業員台帳機能の資格情報・就業状態管理
- ✅ **Phase1-3**: 社会保険料自動計算機能
- ✅ **Phase1-4**: 月次保険料一覧・会社負担集計機能（基本実装）
- ✅ **Phase1-5**: 標準報酬月額・等級・保険プランマスタ管理機能
- ✅ **Phase1-6**: 賞与管理・賞与保険料計算機能
- ✅ **Phase1-7**: マイページ機能
- ✅ **Phase1-8**: 従業員とユーザーアカウントの自動紐づけ機能
- ✅ **Phase1-9**: 月次保険料一覧機能の拡張（過去月分閲覧、絞り込み、合計行）
- ✅ **Phase1-10**: 負担構成ダッシュボード機能（基本実装）
- ✅ **Phase1-11**: 保険料シミュレーション機能の実装
- ✅ **Phase1-12**: 負担構成ダッシュボード機能の拡張（グラフ表示）

### 実装率
- **完全実装**: 約52%（11/21機能）
- **部分実装含む**: 約62%（13/21機能）

---

## 🎯 Phase2の実装フェーズ提案

Phase1が完了したため、Phase2として以下の実装を提案します。

### Phase2-1: セキュリティ・アクセス制御の強化

**優先度**: 🔴 最高（本番環境に向けた必須機能）  
**推定工数**: 高（3-4週間）

**目的**: Firestoreセキュリティルールと画面レベルのアクセス制御を強化し、本番環境で安全に運用できるようにする

**実装内容**:
1. **Firestoreセキュリティルールの詳細化**
   - 事業所IDに基づくデータ分離
   - ロール別のアクセス制御（admin/hr/employee）
   - 読み取り・書き込み権限の細分化

2. **画面レベルのアクセス制御**
   - ロール別のメニュー表示制御
   - 機能へのアクセス制限（Guardsの拡張）
   - 権限がない場合のエラーメッセージ表示

3. **識別情報のマスキング表示**
   - 個人情報の一部マスキング
   - 権限に応じた表示制御

**関連ファイル**:
- `firestore.rules`（大幅拡張）
- `src/app/guards/auth.guard.ts`（拡張）
- `src/app/guards/role.guard.ts`（新規）
- 各ページコンポーネント（アクセス制御追加）

**技術要件**:
- Firestoreセキュリティルールの理解
- Angular Guardsの活用
- ロール管理の実装

**注意事項**:
- 本番環境に向けた必須機能のため、最優先で実装
- 既存データへの影響を最小限に抑える
- セキュリティルールのテストを十分に行う

---

### Phase2-2: 被扶養者管理機能の実装

**優先度**: 🟡 中（実務上必要な機能）  
**推定工数**: 中（2-3週間）

**目的**: 従業員の被扶養者情報を管理できる機能を実装する

**実装内容**:
1. **被扶養者情報の型定義**
   - `Dependent`型の定義
   - Firestoreコレクション構造の設計

2. **被扶養者登録・編集画面**
   - 基本情報の入力（氏名、続柄、生年月日など）
   - 資格取得日・喪失日の管理
   - 従業員との紐づけ

3. **被扶養者一覧表示**
   - 従業員別の被扶養者一覧
   - 資格状況の表示

**関連ファイル**:
- `src/app/types.ts`（型定義追加）
- `src/app/services/dependents.service.ts`（新規）
- `src/app/pages/dependents/dependents.page.ts`（新規）

**技術要件**:
- Firestoreコレクション設計
- 従業員とのリレーション管理

---

### Phase2-3: 標準報酬決定・改定履歴管理機能の実装

**優先度**: 中  
**推定工数**: 中

**目的**: 従業員の被扶養者情報を管理できる機能を実装する

**実装内容**:
1. **被扶養者情報の型定義**
   - `Dependent`型の定義
   - Firestoreコレクション構造の設計

2. **被扶養者登録・編集画面**
   - 基本情報の入力（氏名、続柄、生年月日など）
   - 資格取得日・喪失日の管理
   - 従業員との紐づけ

3. **被扶養者一覧表示**
   - 従業員別の被扶養者一覧
   - 資格状況の表示

**関連ファイル**:
- `src/app/types.ts`（型定義追加）
- `src/app/services/dependents.service.ts`（新規）
- `src/app/pages/dependents/dependents.page.ts`（新規）
- `src/app/pages/dependents/dependent-form-dialog.component.ts`（新規）

**技術要件**:
- Firestoreコレクション設計
- 従業員とのリレーション管理
- 資格取得・喪失日の管理ロジック

---

### Phase1-15: CSVインポート・エクスポート機能の実装

**優先度**: 🟡 中（運用効率化のための機能）  
**推定工数**: 中（2-3週間）

**目的**: 従業員情報や保険料データの一括インポート・エクスポート機能を実装する

**実装内容**:
1. **CSVエクスポート機能**
   - 月次保険料一覧のエクスポート
   - 従業員台帳のエクスポート
   - 賞与一覧のエクスポート

2. **CSVインポート機能**
   - 従業員情報の一括インポート
   - 形式チェック
   - エラー行の確認・修正画面

**関連ファイル**:
- `src/app/utils/csv-export.service.ts`（新規）
- `src/app/utils/csv-import.service.ts`（新規）
- `src/app/pages/import/import.page.ts`（実装）

**技術要件**:
- CSVパーサーライブラリの活用
- エラーハンドリング
- 進捗表示

---

## 📋 Phase2の推奨実装順序

### 第1段階（必須機能）
1. **Phase2-1: セキュリティ・アクセス制御の強化**
   - 本番環境に向けた必須機能
   - 他の機能の基盤となるため、最優先で実装
   - 推定期間: 3-4週間

### 第2段階（実務上必要な機能）
2. **Phase2-2: 被扶養者管理機能の実装**
   - 実務上必要な機能
   - Phase2-1完了後に実装
   - 推定期間: 2-3週間

3. **Phase2-3: 標準報酬決定・改定履歴管理機能の実装**
   - 実務上必要な機能
   - Phase2-1完了後に実装
   - Phase2-2と並行実装可能
   - 推定期間: 2-3週間

### 第3段階（運用効率化）
4. **Phase2-4: CSVインポート・エクスポート機能の実装**
   - 運用効率化のための機能
   - Phase2-1完了後に実装
   - 他の機能と並行実装可能
   - 推定期間: 2-3週間

---

## 🔍 各フェーズの詳細検討事項

### Phase2-1（セキュリティ）
- **ルール設計**: Firestoreセキュリティルールの複雑さ
- **テスト**: セキュリティルールのテスト方法
- **移行**: 既存データへの影響

### Phase2-2（被扶養者管理）
- **データモデル**: 被扶養者情報の構造設計
- **資格管理**: 資格取得・喪失日の管理ロジック
- **年次見直し**: 年次見直し支援機能の必要性

### Phase2-3（標準報酬履歴）

- **データモデル**: 履歴情報の構造設計（従業員とのリレーション）
- **決定区分**: 決定区分の種類と管理方法
- **適用開始**: 適用開始年月の自動計算ロジック

### Phase2-4（CSV機能）
- **形式定義**: CSV形式の仕様定義
- **エラーハンドリング**: インポート時のエラー処理
- **バリデーション**: データ整合性チェック

---

## 📌 注意事項

- **Phase2-1（セキュリティ）は最優先**: 本番環境に向けた必須機能のため、他の機能より優先して実装する
- **段階的な実装**: Phase2-1完了後、Phase2-2とPhase2-3は並行実装可能
- **テストの重要性**: 特にPhase2-1では、セキュリティルールのテストを十分に行う
- **既存機能への影響**: Phase2-1の実装により、既存機能への影響がある可能性があるため、十分な検証を行う

---

## 🚀 Phase2以降の展望

Phase2完了後、以下の機能をPhase3として検討可能：

1. **社会保険手続き履歴・期限管理機能（(19)）**
2. **納付状況管理機能（(21)）**
3. **社会保険用語・ルールヘルプ機能（(17)）**
4. **従業員情報の変更申請・承認機能（(18)）**

---

以上でPhase2の実装フェーズ提案は完了です。詳細な実装計画は`PHASE2_IMPLEMENTATION_PLAN.md`を参照してください。各フェーズの詳細な実装指示書は、実装開始前に作成することを推奨します。
